# 使用mllib完成mnist手写识别任务

## 什么是mnist数据集和手写识别任务

val train = spark.read.format("libsvm").load("/data/mnist_train.libsvm")

val test = spark.read.format("libsvm").load("/data/mnist_test.libsvm")

val layers = Array[Int](784, 784, 784, 10)

import org.apache.spark.ml.classification.MultilayerPerceptronClassifier
import org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator

val trainer = new MultilayerPerceptronClassifier().setLayers(layers).setBlockSize(128).setSeed(1234L).setMaxIter(100)

val result = model.transform(test)

val predictionAndLabels = result.select("prediction", "label")

val evaluator = new MulticlassClassificationEvaluator().setMetricName("accuracy")

println(s"Test set accuracy = ${evaluator.evaluate(predictionAndLabels)}")

result.toDF.createOrReplaceTempView("deep_learning")

spark.sql("select * from deep_learning where prediction = label and label = 2.0 limit 2").show()

spark.sql("with x as (select count(*) as count_x from deep_learning where prediction = label),y as (select count(*) as total from deep_learning) select count_x/total as accuracy from x,y").show()

spark.sql("select (select count(*) from deep_learning where label=prediction)/count(*) as accuracy from deep_learning").show()